import { useState, useEffect } from "react";
import s from "./Popup.module.css";
import { MainForm } from "../Form/MainForm";
import { motion } from "framer-motion";
import { Link } from "react-router-dom";
import { useMediaQuery } from "react-responsive";
import { AnimatedHeadingFaster } from "../AnimatedHeading/AnimatedHeading";

export const Popup = ({ onClose, contactInfo }) => {
  const [isClosing, setIsClosing] = useState(false);
  const isDesktop = useMediaQuery({ query: "(min-width: 1024px)" });
  const isMobile = useMediaQuery({ query: "(max-width: 1023px)" });

  const fadeIn = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0, transition: { duration: 0.3 } },
  };

  useEffect(() => {
    // Блокуємо скрол для всієї сторінки
    const originalOverflow = document.body.style.overflow;
    document.body.style.overflow = "hidden";

    // Відновлюємо скрол для сторінки при закритті
    return () => {
      document.body.style.overflow = originalOverflow;
    };
  }, []);

  const handleClose = () => {
    setIsClosing(true);
    setTimeout(() => {
      onClose(); // Викликаємо onClose після завершення анімації
    }, 500); // Тривалість анімації закриття
  };

  return (
    <div
      data-lenis-prevent
      className={`${s.popupOverlay} ${isClosing ? s.hide : ""}`}
      onClick={handleClose}
    >
      <div
        data-lenis-prevent
        className={`${s.popupContent} ${isClosing ? s.hide : ""}`}
        onClick={(e) => e.stopPropagation()}
      >
        <button className={s.popupClose} onClick={handleClose}>
          <svg
            width="18"
            height="18"
            viewBox="0 0 18 18"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M10.6499 9.01417L17.6646 1.99936C18.1211 1.54307 18.1211 0.805292 17.6646 0.349055C17.2083 -0.107237 16.4706 -0.107237 16.0143 0.349055L8.99946 7.3638L1.98488 0.349055C1.52837 -0.107237 0.790862 -0.107237 0.33457 0.349055C-0.12194 0.805347 -0.12194 1.54307 0.33457 1.99936L7.3491 9.01417L0.334625 16.0289C-0.121885 16.4852 -0.121885 17.223 0.334625 17.6792C0.44286 17.7878 0.571475 17.8739 0.713082 17.9325C0.854689 17.9912 1.0065 18.0213 1.15978 18.0212C1.4585 18.0212 1.75734 17.9068 1.98494 17.6792L8.99946 10.6645L16.0143 17.6792C16.1226 17.7878 16.2512 17.8738 16.3928 17.9325C16.5344 17.9912 16.6862 18.0213 16.8395 18.0212C17.1382 18.0212 17.437 17.9068 17.6646 17.6792C18.1211 17.2229 18.1211 16.4852 17.6646 16.0289L10.6499 9.01417Z"
              fill="white"
            />
          </svg>
        </button>

        {isDesktop && (
          <motion.div className="shrink-0" initial="visible" variants={fadeIn}>
            <div className={s.contactInfo}>
              <h1>CONTACT</h1>

              <div>
                <h4>TALK TO US</h4>
                <a href={`mailto:${contactInfo?.talk_to_us_email || ""}`}>
                  {contactInfo?.talk_to_us_email || "Not available"}
                </a>
              </div>

              <div>
                <h4 className="mb-[5vw]">SOCIAL MEDIA</h4>
                <ul className={s.socialLinks} role="list">
                  <li>
                    <a href="">
                      <svg
                        width="28"
                        height="29"
                        viewBox="0 0 28 29"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clipPath="url(#clip0_1576_24781)">
                          <path
                            d="M3.36536 0.5C1.50561 0.5 0.000300881 2.01061 0 3.86934C0 5.72988 1.50531 7.24019 3.36566 7.24019C5.22089 7.24019 6.7283 5.72988 6.7283 3.86934C6.7283 2.01031 5.22059 0.5 3.36536 0.5ZM0.462755 9.79697H6.26585V28.5H0.462755V9.79697ZM21.0391 9.33191C18.2163 9.33191 16.3234 10.8823 15.5486 12.3525H15.471V9.79697H9.90501V28.4997H15.703V19.2473C15.703 16.8081 16.1666 14.4454 19.1857 14.4454C22.1614 14.4454 22.2011 17.2352 22.2011 19.4038V28.4994H28V18.241C28 13.2055 26.9153 9.33191 21.0391 9.33191Z"
                            fill="white"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_1576_24781">
                            <rect
                              width="28"
                              height="28"
                              fill="white"
                              transform="translate(0 0.5)"
                            />
                          </clipPath>
                        </defs>
                      </svg>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <svg
                        width="28"
                        height="29"
                        viewBox="0 0 28 29"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clipPath="url(#clip0_1576_24783)">
                          <g clipPath="url(#clip1_1576_24783)">
                            <path
                              d="M27.9723 8.73208C27.9067 7.24433 27.6661 6.22152 27.3214 5.33523C26.9659 4.39447 26.4189 3.5522 25.7023 2.85202C25.0021 2.14095 24.1543 1.58841 23.2244 1.23843C22.333 0.893784 21.3155 0.653198 19.8278 0.587603C18.3289 0.516452 17.8531 0.5 14.0516 0.5C10.25 0.5 9.77421 0.516452 8.28091 0.582047C6.79316 0.647642 5.77034 0.888443 4.88428 1.23287C3.9433 1.58841 3.10103 2.13539 2.40085 2.85202C1.68977 3.5522 1.13745 4.40002 0.787254 5.32989C0.442612 6.22152 0.202026 7.23877 0.136431 8.72652C0.0652803 10.2254 0.0488281 10.7012 0.0488281 14.5027C0.0488281 18.3043 0.0652803 18.7801 0.130875 20.2734C0.196471 21.7611 0.437271 22.784 0.781912 23.6702C1.13745 24.611 1.68977 25.4533 2.40085 26.1535C3.10103 26.8645 3.94885 27.4171 4.87872 27.767C5.77034 28.1117 6.7876 28.3523 8.27556 28.4179C9.76865 28.4837 10.2447 28.4999 14.0462 28.4999C17.8477 28.4999 18.3236 28.4837 19.8169 28.4179C21.3046 28.3523 22.3274 28.1117 23.2135 27.767C25.0953 27.0395 26.583 25.5518 27.3105 23.6702C27.655 22.7786 27.8958 21.7611 27.9614 20.2734C28.027 18.7801 28.0434 18.3043 28.0434 14.5027C28.0434 10.7012 28.0379 10.2254 27.9723 8.73208ZM25.4508 20.164C25.3905 21.5315 25.1609 22.2699 24.9694 22.7622C24.4989 23.982 23.5308 24.9501 22.311 25.4206C21.8187 25.612 21.0749 25.8417 19.7128 25.9018C18.236 25.9676 17.793 25.9838 14.0571 25.9838C10.3212 25.9838 9.87271 25.9676 8.4012 25.9018C7.03374 25.8417 6.29532 25.612 5.80304 25.4206C5.19601 25.1962 4.64348 24.8407 4.19499 24.3758C3.73006 23.9217 3.37452 23.3747 3.15017 22.7677C2.95873 22.2754 2.72904 21.5315 2.669 20.1696C2.60319 18.6927 2.58695 18.2496 2.58695 14.5136C2.58695 10.7777 2.60319 10.3292 2.669 8.85793C2.72904 7.49047 2.95873 6.75205 3.15017 6.25976C3.37452 5.65253 3.73006 5.1002 4.20055 4.65151C4.65437 4.18657 5.20136 3.83103 5.80859 3.6069C6.30087 3.41546 7.04486 3.18577 8.40675 3.12551C9.88361 3.05992 10.3267 3.04347 14.0625 3.04347C17.8039 3.04347 18.2469 3.05992 19.7184 3.12551C21.0858 3.18577 21.8243 3.41546 22.3165 3.6069C22.9236 3.83103 23.4761 4.18657 23.9246 4.65151C24.3895 5.10554 24.7451 5.65253 24.9694 6.25976C25.1609 6.75205 25.3905 7.49581 25.4508 8.85793C25.5164 10.3348 25.5328 10.7777 25.5328 14.5136C25.5328 18.2496 25.5164 18.6871 25.4508 20.164Z"
                              fill="white"
                            />
                            <path
                              d="M14.0512 7.30957C10.0803 7.30957 6.8584 10.5312 6.8584 14.5024C6.8584 18.4736 10.0803 21.6952 14.0512 21.6952C18.0224 21.6952 21.244 18.4736 21.244 14.5024C21.244 10.5312 18.0224 7.30957 14.0512 7.30957ZM14.0512 19.1682C11.4751 19.1682 9.38541 17.0788 9.38541 14.5024C9.38541 11.926 11.4751 9.83658 14.0512 9.83658C16.6276 9.83658 18.717 11.926 18.717 14.5024C18.717 17.0788 16.6276 19.1682 14.0512 19.1682Z"
                              fill="white"
                            />
                            <path
                              d="M23.2092 7.02587C23.2092 7.95318 22.4573 8.70506 21.5298 8.70506C20.6025 8.70506 19.8506 7.95318 19.8506 7.02587C19.8506 6.09835 20.6025 5.34668 21.5298 5.34668C22.4573 5.34668 23.2092 6.09835 23.2092 7.02587Z"
                              fill="white"
                            />
                          </g>
                        </g>
                        <defs>
                          <clipPath id="clip0_1576_24783">
                            <rect
                              width="28"
                              height="28"
                              fill="white"
                              transform="translate(0 0.5)"
                            />
                          </clipPath>
                          <clipPath id="clip1_1576_24783">
                            <rect
                              width="28"
                              height="28"
                              fill="white"
                              transform="translate(0 0.5)"
                            />
                          </clipPath>
                        </defs>
                      </svg>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <svg
                        width="28"
                        height="29"
                        viewBox="0 0 28 29"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clipPath="url(#clip0_1576_24785)">
                          <path
                            fillRule="evenodd"
                            clipRule="evenodd"
                            d="M23.9205 4.5691C21.2883 1.94651 17.7878 0.501531 14.0585 0.5C6.37408 0.5 0.120012 6.72396 0.116935 14.3737C0.11588 16.8191 0.757745 19.2062 1.97782 21.3103L0 28.5L7.39067 26.5705C9.42709 27.6761 11.7198 28.2587 14.0529 28.2594H14.0588C21.7424 28.2594 27.9971 22.0349 28 14.3848C28.0016 10.6773 26.5528 7.19156 23.9205 4.5691ZM14.0585 25.9161H14.0537C11.9745 25.9153 9.93536 25.3592 8.15597 24.3087L7.73307 24.0586L3.34732 25.2037L4.5179 20.9481L4.24227 20.5118C3.08233 18.6757 2.46978 16.5535 2.47084 14.3745C2.47326 8.01625 7.67157 2.84334 14.0632 2.84334C17.1583 2.84434 20.0677 4.04541 22.2554 6.22521C24.4431 8.40501 25.6472 11.3024 25.6462 14.3839C25.6435 20.7427 20.4455 25.9161 14.0585 25.9161ZM20.4146 17.2791C20.0663 17.1055 18.3536 16.2671 18.0342 16.1512C17.7151 16.0355 17.4826 15.9779 17.2506 16.3248C17.0183 16.6718 16.3508 17.4527 16.1475 17.684C15.9442 17.9154 15.7412 17.9444 15.3928 17.7708C15.0444 17.5973 13.922 17.2311 12.5914 16.05C11.5559 15.1307 10.8568 13.9955 10.6535 13.6486C10.4505 13.3013 10.6517 13.1318 10.8063 12.941C11.1834 12.475 11.561 11.9864 11.6771 11.7552C11.7933 11.5237 11.7351 11.3213 11.6479 11.1478C11.561 10.9743 10.8644 9.26789 10.5741 8.57354C10.2912 7.89782 10.0042 7.98904 9.79024 7.97849C9.58728 7.96839 9.35495 7.96633 9.12262 7.96633C8.89042 7.96633 8.51297 8.05296 8.1936 8.40024C7.87436 8.74736 6.97458 9.58596 6.97458 11.2924C6.97458 12.9988 8.22279 14.6473 8.39692 14.8787C8.571 15.1101 10.8534 18.6118 14.3477 20.1133C15.1788 20.4708 15.8276 20.6839 16.3337 20.8437C17.1682 21.1076 17.9274 21.0703 18.5277 20.9811C19.1971 20.8815 20.5885 20.1424 20.8791 19.3326C21.1693 18.5228 21.1693 17.8287 21.082 17.684C20.9952 17.5394 20.7628 17.4527 20.4146 17.2791Z"
                            fill="white"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_1576_24785">
                            <rect
                              width="28"
                              height="28"
                              fill="white"
                              transform="translate(0 0.5)"
                            />
                          </clipPath>
                        </defs>
                      </svg>
                    </a>
                  </li>
                  <li>
                    <a href="">
                      <svg
                        width="28"
                        height="29"
                        viewBox="0 0 28 29"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <g clipPath="url(#clip0_1576_24787)">
                          <path
                            d="M16.4382 28.5V15.7288H20.7232L21.3661 10.7502H16.4382V7.57206C16.4382 6.13108 16.8367 5.14907 18.9054 5.14907L21.5396 5.14799V0.694922C21.084 0.635723 19.5203 0.5 17.7003 0.5C13.8999 0.5 11.298 2.81975 11.298 7.07898V10.7502H7V15.7288H11.298V28.5H16.4382Z"
                            fill="white"
                          />
                        </g>
                        <defs>
                          <clipPath id="clip0_1576_24787">
                            <rect
                              width="28"
                              height="28"
                              fill="white"
                              transform="translate(0 0.5)"
                            />
                          </clipPath>
                        </defs>
                      </svg>
                    </a>
                  </li>
                </ul>
              </div>

              <div className={s.dynamicWidth}>
                <h4>COME SEE US</h4>
                <Link>{contactInfo?.come_see_us || "Not available"}</Link>
              </div>

              <div>
                <h4>WORK WITH US</h4>
                <a href={`mailto:${contactInfo?.work_with_us_email || ""}`}>
                  {contactInfo?.work_with_us_email || "Not available"}
                </a>
              </div>
            </div>
          </motion.div>
        )}

        {isMobile && (
          <h2 className={s.title}>
            <AnimatedHeadingFaster text={"DROP US A LINE"} />
          </h2>
        )}

        <MainForm closePopup={handleClose} />
      </div>
    </div>
  );
};
